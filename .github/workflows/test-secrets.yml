name: ðŸ” Test VPS_PASSWORD Secret

on:
  workflow_dispatch:

jobs:
  test-secrets:
    name: ðŸ” Check VPS_PASSWORD Configuration
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ” Verify VPS_PASSWORD Secret
      run: |
        echo "ðŸ” TESTING VPS_PASSWORD SECRET CONFIGURATION"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        
        echo "ðŸ“‹ CHECKING SECRET:"
        echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        
        # Check VPS_PASSWORD
        if [ -z "${{ secrets.VPS_PASSWORD }}" ]; then
          echo "âŒ VPS_PASSWORD: Missing"
          echo ""
          echo "ðŸš¨ ERROR: VPS_PASSWORD secret is required for deployment!"
          echo ""
          echo "ðŸ“‹ TO FIX THIS:"
          echo "1. Go to GitHub repository Settings"
          echo "2. Click on 'Secrets and variables' â†’ 'Actions'"
          echo "3. Click 'New repository secret'"
          echo "4. Name: VPS_PASSWORD"
          echo "5. Value: Your VPS root password"
          echo ""
          echo "::error::VPS_PASSWORD secret is missing"
          exit 1
        else
          echo "âœ… VPS_PASSWORD: Configured (${#{{ secrets.VPS_PASSWORD }}} characters)"
          echo ""
          echo "ðŸŽ‰ SECRET CONFIGURATION IS CORRECT!"
          echo ""
          echo "ðŸ“‹ DEPLOYMENT READY:"
          echo "â€¢ Host: 82.25.69.57 (hard-coded)"
          echo "â€¢ Username: root (hard-coded)"
          echo "â€¢ Password: âœ… From VPS_PASSWORD secret"
          echo "â€¢ Domain: fuseloja.com.br"
        fi
        
        echo ""
        echo "ðŸš€ NEXT STEPS:"
        echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
        echo "1. Push code to main branch for automatic deploy"
        echo "2. Or run 'Deploy FuseLoja' workflow manually"
        echo "3. Test connection with 'Test VPS Connection' workflow"

    - name: ðŸ“Š Generate Summary Report
      run: |
        echo "## ðŸ” VPS_PASSWORD Secret Test Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if [ -n "${{ secrets.VPS_PASSWORD }}" ]; then
          echo "### âœ… Secret Configuration: SUCCESS" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **VPS_PASSWORD**: âœ… Configured (${#{{ secrets.VPS_PASSWORD }}} characters)" >> $GITHUB_STEP_SUMMARY
          echo "- **Host**: 82.25.69.57 (pre-configured)" >> $GITHUB_STEP_SUMMARY
          echo "- **Username**: root (pre-configured)" >> $GITHUB_STEP_SUMMARY
          echo "- **Domain**: fuseloja.com.br" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸš€ Ready for Deployment!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Options to deploy:**" >> $GITHUB_STEP_SUMMARY
          echo "1. **Automatic**: Push to main branch" >> $GITHUB_STEP_SUMMARY
          echo "2. **Manual**: Run 'Deploy FuseLoja' workflow" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Next steps:**" >> $GITHUB_STEP_SUMMARY
          echo "- Test VPS connection with 'Test VPS Connection' workflow" >> $GITHUB_STEP_SUMMARY
          echo "- Deploy your application!" >> $GITHUB_STEP_SUMMARY
        else
          echo "### âŒ Secret Configuration: FAILED" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Missing secret:**" >> $GITHUB_STEP_SUMMARY
          echo "- **VPS_PASSWORD**: âŒ Not configured" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”§ How to Fix" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. Go to **Settings** â†’ **Secrets and variables** â†’ **Actions**" >> $GITHUB_STEP_SUMMARY
          echo "2. Click **New repository secret**" >> $GITHUB_STEP_SUMMARY
          echo "3. **Name**: \`VPS_PASSWORD\`" >> $GITHUB_STEP_SUMMARY
          echo "4. **Value**: Your VPS root password (same as \`ssh root@82.25.69.57\`)" >> $GITHUB_STEP_SUMMARY
          echo "5. Click **Add secret**" >> $GITHUB_STEP_SUMMARY
        fi