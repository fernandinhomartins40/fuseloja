#!/bin/bash

# ü§ñ Script Automatizado - Configurar GitHub Secrets
# Requisito: GitHub CLI instalado (gh)

set -e

echo "üöÄ Configurando GitHub Secrets automaticamente..."
echo "=================================================="

# Verificar se GitHub CLI est√° instalado
if ! command -v gh &> /dev/null; then
    echo "‚ùå GitHub CLI n√£o encontrado!"
    echo "Instale com: sudo apt install gh"
    echo "Ou use a configura√ß√£o manual."
    exit 1
fi

# Verificar se est√° logado
if ! gh auth status &> /dev/null; then
    echo "üîê Fazendo login no GitHub..."
    gh auth login
fi

echo "‚úÖ GitHub CLI configurado!"
echo ""

# Configurar Secrets
echo "üîë Configurando Secrets..."

gh secret set SSH_HOST --body "82.25.69.57"
echo "‚úÖ SSH_HOST configurado"

gh secret set SSH_USERNAME --body "root"
echo "‚úÖ SSH_USERNAME configurado"

gh secret set SSH_PASSWORD --body "Nando157940/"
echo "‚úÖ SSH_PASSWORD configurado"

gh secret set JWT_SECRET --body "fuseloja-super-secret-jwt-key-2024-production-secure"
echo "‚úÖ JWT_SECRET configurado"

gh secret set JWT_REFRESH_SECRET --body "fuseloja-super-secret-refresh-key-2024-production-secure"
echo "‚úÖ JWT_REFRESH_SECRET configurado"

gh secret set EMAIL_HOST --body "smtp.gmail.com"
echo "‚úÖ EMAIL_HOST configurado"

gh secret set EMAIL_PORT --body "587"
echo "‚úÖ EMAIL_PORT configurado"

gh secret set EMAIL_USER --body "noreply@fuseloja.com.br"
echo "‚úÖ EMAIL_USER configurado"

# EMAIL_PASSWORD precisa ser configurado manualmente
echo "‚ö†Ô∏è  EMAIL_PASSWORD precisa ser configurado manualmente:"
echo "   1. Gere senha de app no Gmail"
echo "   2. Execute: gh secret set EMAIL_PASSWORD --body 'SUA_SENHA_GERADA'"

echo ""
echo "üîß Configurando Variables..."

gh variable set DOMAIN_NAME --body "www.fuseloja.com.br"
echo "‚úÖ DOMAIN_NAME configurado"

gh variable set CORS_ORIGINS --body "https://www.fuseloja.com.br,https://fuseloja.com.br"
echo "‚úÖ CORS_ORIGINS configurado"

echo ""
echo "üéâ Configura√ß√£o conclu√≠da!"
echo "=================================================="
echo "üìã Secrets configurados: 8/9 (falta EMAIL_PASSWORD)"
echo "üìã Variables configurados: 2/2"
echo ""
echo "üîó Verificar: https://github.com/fernandinhomartins40/fuseloja/settings/secrets/actions"
echo ""
echo "‚ö° Pr√≥ximos passos:"
echo "1. Configure EMAIL_PASSWORD manualmente"
echo "2. Configure DNS do dom√≠nio"
echo "3. O deploy ser√° ativado automaticamente!" 